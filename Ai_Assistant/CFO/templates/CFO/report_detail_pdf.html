{% load static %}
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>{{ report.title }} - PDF</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background: #fff; padding: 1rem; }
h2, h5 { color: #212529; margin-bottom: 0.5rem; }
.card { border:1px solid #eaecef; border-radius:0.75rem; padding:1rem; margin-bottom:1rem; }
.kpi-table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
.kpi-table th, .kpi-table td { border: 1px solid #dee2e6; padding: 0.75rem; text-align: left; font-size: 0.95rem; }
.kpi-table th { background-color: #f8f9fa; width: 40%; }
.risk-badge { font-size:0.85rem; padding:0.35rem 0.9rem; border-radius:999px; font-weight:600; }
.chart-box { border:1px solid #eaecef; border-radius:0.75rem; padding:0.5rem; text-align:center; margin-bottom:0.75rem; height: 240px; display:flex; flex-direction: column; justify-content: center; align-items: center; }
.chart-box img { max-height: 180px; width: auto; }
.chart-title { font-size:0.85rem; margin-top:0.25rem; color: #495057; }
</style>
</head>
<body>

<h2>{{ report.title }}</h2>
<p>Uploaded on {{ report.uploaded_at|date:"F j, Y, g:i a" }}</p>

<!-- Key Metrics Table (Vertical, Full Width) -->
<div class="card">
<h5>Key Metrics</h5>
<table class="kpi-table">
    <tbody>
        <tr>
            <th>Revenue Growth</th>
            <td>{{ kpis.revenue_growth|floatformat:2 }}%</td>
        </tr>
        <tr>
            <th>Total Profit</th>
            <td>‚Çπ{{ kpis.total_profit|floatformat:0 }}</td>
        </tr>
        <tr>
            <th>Total Expense</th>
            <td>‚Çπ{{ kpis.total_expense|floatformat:0 }}</td>
        </tr>
        <tr>
            <th>Cash Balance</th>
            <td>‚Çπ{{ kpis.cash_balance|floatformat:0 }}</td>
        </tr>
        <tr>
            <th>Profit Margin</th>
            <td>{{ kpis.profit_margin|floatformat:2 }}%</td>
        </tr>
        {% if report.runway %}
        <tr>
            <th>Runway (Months)</th>
            <td>{{ kpis.runway|floatformat:1 }}</td>
        </tr>
        {% endif %}
        {% if report.burn_rate %}
        <tr>
            <th>Burn Rate</th>
            <td>{{ kpis.burn_rate|floatformat:1 }}</td>
        </tr>
        {% endif %}
    </tbody>
</table>
</div>

<!-- Risk Badge -->
<div class="mb-3">
<h5>Risk Assessment</h5>
<span class="risk-badge
      {% if report.risk_flag == 'High Risk' %}bg-danger text-white
      {% elif report.risk_flag == 'Moderate/OK' %}bg-warning text-dark
      {% else %}bg-success text-white{% endif %}">
  {{ report.risk_flag|default:"No Risk Flag" }}
</span>
</div>

<!-- Charts -->
<div class="row">
    {% for name, img in chart_images.items %}
      <div class="col-md-6">
        <div class="chart-box">
            <img src="{{ img }}">
            <div class="chart-title">{{ name }}</div>
        </div>
      </div>
    {% endfor %}
</div>

<!-- AI Insights & Recommendations -->
<div class="card">
<h5>AI Insights & Recommendations</h5>
<ul>
  {% if kpis.runway < 6 %}<li class="text-danger">üö® Runway below 6 months: take immediate actions.</li>{% endif %}
  {% if kpis.profit_margin < 0 %}<li class="text-warning">‚ö†Ô∏è Negative profit margin detected ‚Äî review costs.</li>{% endif %}
  {% if kpis.revenue_growth < 0 %}<li class="text-warning">üìâ Revenue declining ‚Äî investigate channels.</li>{% endif %}
  <li>‚úÖ Maintain adequate cash reserves and monitor vendors.</li>
</ul>
</div>

</body>
</html>